/***************************** Manuel Gonzalez           ** design@stheory.com        ** www.stheory.com           ** www.codingcolor.com       ******************************/package com.view{	import flash.display.Sprite;	import flash.display.MovieClip;	import flash.events.Event;	import flash.geom.Rectangle;	import flash.system.*;	public class PanelScroller extends Sprite {		private var slider:Slider;		private var dProvider:Array;		private var tnArray:Array;		private var panelsCreated:Boolean = false;		private var panelHeight:Number;		private var content:Sprite;		private var contentHeight:Number = 0;		private var contentMask:MovieClip;		private var contentRectangle:Rectangle= new Rectangle( 0, 0, 310, 350 );		private var selectedPanel:Object;						public function get currentPanel():Object		{			return selectedPanel;		}		public function set dataprovider(inData:Array):void {			dProvider = inData;			buildContainer();		}		public function get dataprovider():Array {			return dProvider;		}		/*Constructor*/		public function PanelScroller() {			Security.allowInsecureDomain("*");			Security.allowDomain("*");			Security.loadPolicyFile("http://i.ytimg.com/crossdomain.xml");			slider = sliderControl;			slider.visible = false;			slider.addEventListener(Event.CHANGE,slideUpdate);			content = new Sprite();			content.x = 0;			addChild(content);		}		/*		Method:buildContainer		Parameters:		Returns:		*/		private function buildContainer():void {			if(panelsCreated)			{				var child:int = content.numChildren;				while( child -- )				{					content.removeChildAt(child);				}				slider.percent = 0;				contentHeight = 0;			}						tnArray = new Array();			for (var i:uint = 0; i < dProvider.length; i++) {				tn = new VideoPanel();				tn.control = this;				tn.vidTitle = dProvider[i].title;				tn.id = dProvider[i].id;				tn.url =dProvider[i].url;				tn.viewCount = dProvider[i].count;				tn.tnUrl = dProvider[i].tnURL;				content.addChild(tn);				tnArray.push(tn);			}			panelsCreated = true;			adjustLayout();		}		/*		Method:adjustLayout		Parameters:		Returns:		*/		private function adjustLayout():void {			var tnHeight:Number			for (var j:uint = 0; j < tnArray.length; j++) {				tnArray[j].y = (tnArray[j].y+ tnArray[j].height)*j;				tnHeight = tnArray[j].height;//I'm doing this because I didn't want to hard code the panel height				tnArray[j].init();			}						contentHeight = tnHeight*tnArray.length;			content.scrollRect = contentRectangle;			if (contentHeight > slider.trackHeight) {				slider.visible = true;			}		}		/*		Method:slideUpdate		Parameters:		event:Event		Returns:		*/		private function slideUpdate(event:Event):void {			var pcent:Number = slider.percent;			var scrollable:Number = contentHeight - content.scrollRect.height;			var sr:Rectangle = content.scrollRect.clone();			sr.y = scrollable * pcent;			content.scrollRect = sr;		}		/*		Method:setSelectedPanel		Parameters:		inObj:Object		Returns:		*/		public function setSelectedPanel(inObj:Object):void		{			selectedPanel = inObj;			dispatchEvent(new Event(Event.CHANGE));		}	}}